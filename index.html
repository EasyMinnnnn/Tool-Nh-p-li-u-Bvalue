<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>📌 Bookmarklet Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px auto;
      max-width: 900px;
    }
    textarea {
      width: 100%;
      height: 300px;
      font-family: monospace;
      font-size: 14px;
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    #output {
      margin-top: 20px;
      font-family: monospace;
      background: #f0f0f0;
      padding: 10px;
      border: 1px dashed #ccc;
      word-break: break-word;
    }
  </style>
</head>
<body>
  <h2>📌 Bookmarklet Generator</h2>
  <p>Dán toàn bộ mã JavaScript vào ô bên dưới, rồi nhấn <b>Tạo Bookmarklet</b>.</p>
  <textarea id="code" placeholder="Dán code JavaScript từ Google Sheet vào đây..."></textarea><br>
  <button onclick="generateBookmarklet()">🔗 Tạo Bookmarklet</button>
  <div id="output"></div>

  <script>
    function generateBookmarklet() {
      let raw = document.getElementById("code").value.trim();

      if (!raw) {
        alert("⚠️ Vui lòng dán đoạn mã trước khi tạo!");
        return;
      }

      // Xử lý lỗi "" từ Google Sheet nếu có
      if (raw.includes('""')) {
        raw = raw.replace(/""/g, '"');
      }

      // Encode URI và bao đoạn mã trong IIFE
      const wrapped = `javascript:(function(){\n${raw}\n})();`;

      const encoded = wrapped.replace(/\n/g, '\\n').replace(/"/g, '%22');
      const htmlOutput = `<b>📎 Bookmarklet:</b><br><code>${wrapped}</code>`;

      document.getElementById("output").innerHTML = htmlOutput;
    }
  </script>
</body>
</html>
